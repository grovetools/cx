Editor integration for `grove-context` provides real-time feedback and streamlined workflows for managing context rules directly within your code editor. The primary integration is the `grove-nvim` plugin for Neovim, which offers a comprehensive set of features for interacting with the `cx` tool.

### Overview of Editor Integration

Editor integration connects the `grove-context` command-line tool (`cx`) to your development environment. This allows you to:

*   Receive immediate feedback on the impact of your context rules as you edit them.
*   Verify which files are matched by a given pattern.
*   Navigate directly from an aliased path in your rules file to the corresponding file or directory.
*   Invoke interactive `cx` commands without leaving the editor.

### Neovim Plugin (`grove-nvim`)

`grove-nvim` is a Neovim plugin that provides deep integration with the `grove-context` ecosystem.

#### Installation and Setup

The plugin can be installed using any standard Neovim package manager. Once installed, it automatically detects `groverules` files and activates its features.

#### Features

**1. Filetype Detection and Syntax Highlighting**

The plugin automatically detects files named `.grove/rules`, `.grovectx`, or with a `.rules` extension and sets the `groverules` filetype. This enables:
*   **Syntax Highlighting**: Distinguishes comments, patterns, directives (`@a:`, `@view:`, `---`), and exclusions (`!`).
*   **Commenting**: Sets the comment string to `#`, allowing standard comment toggling commands (e.g., `gc`) to work correctly.

**2. Real-time Virtual Text**

When editing a `groverules` file, the plugin displays inline virtual text at the end of each rule line, providing immediate feedback. This information is generated by running `cx stats --per-line` in the background.

The virtual text includes:
*   **Token and File Counts**: Shows the approximate token count and the number of files matched by a rule (e.g., `~1.2k tokens (5 files)`).
*   **Exclusion Info**: For exclusion rules, it shows the number of files and tokens that were removed from the context.
*   **No Match Warnings**: Displays a warning (`âš  no matches`) if a rule does not match any files.
*   **Git Repository Status**: For rules that include external Git repositories, it displays the pinned version, resolved commit hash, and audit status.

**3. Interactive Rule Preview**

The `<leader>f?` keybinding invokes an interactive file picker that shows all files matched by the rule under the cursor. This is powered by the `cx resolve` command.

*   **Usage**: Place the cursor on a rule line and press `<leader>f?`.
*   **Functionality**: A floating window appears listing all resolved file paths. This works for simple glob patterns, aliases (`@a:workspace/path`), and ruleset imports (`@a:project::ruleset`).
*   **Adding Files**: You can select one or more files from the picker to add them as explicit, individual rules to your `groverules` file. This is useful for refining a broad pattern into a specific list of files.

**4. Smart Navigation (`gf`)**

The standard Neovim `gf` (go-to-file) command is enhanced to understand Grove aliases. When the cursor is on a path containing an alias like `@a:my-ecosystem:my-repo/src/main.go`, pressing `gf` will resolve the alias and open the correct file, even if it's in a different project outside the current working directory.

If a pattern matches multiple files, `gf` will open a picker to let you choose which file to open.

**5. Interactive Commands**

The plugin provides commands to run interactive `cx` TUIs within a floating terminal window in Neovim:

*   `:GroveContextView`: Opens the `cx view` TUI, providing a full-screen, interactive tree view of the current context.
*   `:GroveRules`: Opens the `cx rules` TUI, allowing you to switch between named rule sets.
*   `:GroveEditContext`: Opens the active rules file for editing. This is particularly useful for quickly accessing job-specific rules defined in `grove-flow` plans.

**6. Alias Resolution**

The plugin bridges the gap between workspace-relative aliases and their absolute file paths on disk.
*   `neogrove internal resolve-aliases`: A command within the plugin's binary (`neogrove`) reads file paths from stdin and uses the `grove-core` workspace discovery mechanism to convert them into canonical `@a:` aliases. This is used to display concise, portable paths in features like the marks window.
*   `cx workspace list --json`: The plugin uses this command to get a real-time list of all discovered workspaces, which is essential for providing completion suggestions for aliases.

### Workflow Example

A typical workflow when using `grove-nvim`:

1.  **Open Rules File**: Open `.grove/rules` in Neovim. Virtual text appears immediately, showing stats for each rule.
2.  **Add a New Rule**: You add a new pattern, e.g., `pkg/**/*.go`. The virtual text updates after a short delay, showing how many files and tokens this rule adds.
3.  **Preview the Rule**: With the cursor on `pkg/**/*.go`, you press `<leader>f?`. A file picker appears, listing all the `.go` files in the `pkg` directory.
4.  **Refine the Rule**: You notice an unwanted file in the preview. You add an exclusion rule below it: `!pkg/unwanted/file.go`. The virtual text on the first rule updates to reflect the exclusion.
5.  **Navigate to a File**: You see an aliased rule like `@a:grove-core/pkg/workspace/types.go`. You place your cursor on it and press `gf`. The `types.go` file from the `grove-core` project opens in a new buffer.
6.  **Check Full Context**: You run `:GroveContextView` to see the complete, hierarchical tree of your context, verifying that all expected files are included and excluded correctly.

### Configuration

`grove-nvim` comes with a set of default keybindings, which can be customized in your Neovim configuration.

**Default Keybindings:**
*   `<leader>f?`: Preview files for the rule under the cursor.
*   `<leader>fe`: Edit the active context rules file.
*   `<leader>fv`: Open the `cx view` TUI.
*   `gf`: Go to the file or alias under the cursor.

### Other Editors (VS Code, etc.)

While Neovim has the most comprehensive integration, `grove-context` can be used with any editor through the command line. The `cx edit` command provides a basic integration point by opening the active rules file in the editor defined by your `$EDITOR` environment variable. This allows for a simpler workflow where you can quickly open, edit, and then run `cx generate` or `cx stats` in a separate terminal.